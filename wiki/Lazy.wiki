#summary Ленивое инжектирование зависимостей

Обычно контейнер создает по запросу целый граф объектов. Однако, иногда некоторые ветви графа могут так никогда и не понадобятся. Контейнер дает возможность некоторые зависимости разрешать не сразу. Например, некоторый код может для своей работы использовать базу данных, но в некоторых случаях обходиться и без нее. В таком коде зависимость от базы данных разумно сделать ленивой, чтобы объект базы данных создавался только в том случае, когда он действительно понадобится.

Следующий пример демонстрирует эту функциональность:
<wiki:comment>[Lazy.Sample</wiki:comment>
{{{

public class Database
{
	public static bool isCreated;
	public Database()
	{
		isCreated = true;
	}
}
public class SomeLogic
{
	private readonly Lazy<Database> db;
	public SomeLogic(Lazy<Database> db)
	{
		this.db = db;
	}
	public void DoSomething(bool useDb)
	{
		if(useDb)
		{
			// только тут контейнер создает реализацию Database
			Database database = db.Get();
			// ... do something with database
		}
		else
		{
			// do something without database
		}
	}
}
[Test]
public void lazy_dependency()
{
	var container = new Container();
	var someLogic = container.Get<SomeLogic>();
	Assert.IsFalse(Database.isCreated);
	someLogic.DoSomething(true); // только тут будет создана БД
	Assert.IsTrue(Database.isCreated);
}
}}}
<wiki:comment></wiki:comment>